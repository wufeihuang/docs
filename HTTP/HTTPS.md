# HTTPS

> 《图解 HTTP》

HTTPS 的主要目的是提供对网站访问的身份认证，保护交换资料的隐私与完整性。

HTTPS = HTTP + 加密 + 认证 + 完整性保护。

把添加了加密及认证机制的 HTTP 称为 HTTPS（HTTP Secure）。

通常 HTTP 直接和 TCP 通信；当使用 SSL 时，则变成 HTTP 先和 SSL 通信，再由 SSL 和 TCP 通信。

此外，HTTPS 默认使用 443 端口；而 HTTP 默认使用 80 端口。

## HTTP 的缺点

- 通信使用明文（不加密），内容可能被窃听
- 不验证通信方的身份，因此有可能遭遇伪装
- 无法证明报文的完整性，所以有可能已遭篡改

## 加密

SSL 采用了公开秘钥加密的加密处理方式。

近代的加密方法中加密算法是公开的，而秘钥却是保密的。通过这种方式得以保持加密方法的安全性。

### 共享秘钥加密（Common key crypto system）

也叫对称秘钥加密。

以共享秘钥方式加密时必须将秘钥也发给对方。

缺点：通信可能被监听，无法确保转交秘钥时的安全性；之后还得考虑秘钥的保管安全。

### 公开秘钥加密（Public-key cryptography）

又叫非对称加密。

公开秘钥加密使用一对非堆成的秘钥，一把叫私有秘钥（私钥，private key），一把叫公开秘钥（公钥，public key）。私钥不被其他人知道，公钥则可以随意发布。

使用公开秘钥加密方式，发送密文的一方使用对方的公开秘钥进行加密处理，对方收到被加密的信息后，再使用自己的私有秘钥进行解密。

另外，想根据密文和公开秘钥，恢复到信息原文是异常困难的。

### HTTPS 采用混合加密机制

公开秘钥加密与共享秘钥相比，其处理速度要慢。HTTP 采用混合的方式利用各自的优点。

HTTPS 请求过程中会有一个交换秘钥环节，在交换秘钥环节使用公开秘钥加密方式，协商出一个共享秘钥；之后的建立通信交换报文阶段则使用共享秘钥方式，使用之前协商的秘钥进行加密和解密。

## 证书

公开秘钥加密的一个问题在于，无法验证公开秘钥本身就是真正的公开秘钥。

为了解决这个问题，可以使用由数字证书认证机构（CA，Certificate Authority）和其相关机关颁发的公开密钥证书。

数字证书认证机构处于客户端与服务器双方都可信赖的第三方机构的立场上，典型代表如威瑞信（VeriSign）。

数字证书认证机构业务流程：首先，服务器的运营人员向数字证书认证机构提出公开秘钥的申请。数字证书认证机构在判明提出申请者的身份之后，会对已申请公开秘钥做数字签名，然后分配这个已签名的公开密钥，并将该公开秘钥放入公钥证书后绑定在一起。

基本步骤如下：

1. 服务器把自己的公开秘钥登录至数字证书认证机构
2. 数字证书认证机构用自己的私有秘钥向服务器的公开密码部署数字签名并颁发公钥证书
3. 客户端拿到服务器的公钥证书后，使用数字证书认证机构的公开秘钥，向数字证书认证机构验证公钥证书上的数字签名，以确认服务器的公开密钥的真实性
4. 客户端使用服务器的公开秘钥对报文加密后发送
5. 服务器使用私有秘钥对报文解密

其中有两个现实条件：浏览器会事先在内部植入常用认证机关的公开秘钥；认证机构也是要经过其他认证机构认证的（可以视为一棵树），处在顶点处的认证机构则是靠现实世界的认证保证权威性和可信度。

## 完整性校验

在 HTTPS 通信中，应用层发送数据时会附加一种叫做 MAC(Message Authentication Code) 的报文摘要。MAC 能够查知报文是否遭到篡改，从而保护报文的完整性。

## SSL 和 TLS

SSL（Secure Socket Layer） 和 TSL（Transport Layer Security）。

SSL 最初是由网景公司开发的，后来转交给了 IETF(Internet Engineering Task Force，Internect 工程任务组)。

IETF 以 SSL3.0 为基准，后又制定了 TLS1.0、TLS1.1、TLS1.2。

TLS 是以 SSL 为原型开发的协议，有时会统一称该协议为 SSL。

## HTTPS 的缺点

- 比 HTTP 慢：通信慢——多了一层 SSL，通信量增加；由于服务端和客户端都需要做加解密处理，会消耗更多 CPU 及内存等资源，导致处理速度慢。
- 成本更高：加密通信消耗更多 CPU 及内存资源；购买证书需要费用。

