# HTTP/1.x 的连接管理

> [HTTP/1\.x 的连接管理 \- HTTP \| MDN](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Connection_management_in_HTTP_1.x)

## 短连接

最早期的模型，也是 HTTP/1.0 的默认模型。

每一个 HTTP 请求都由它自己独立的连接完成。即每发起一个 HTTP 请求之前都会建立一个 TCP 连接。

在 HTTP/1.1 中，只有当 Connection 被设置为 close 时才会用道这个模型。

## 长连接

又被称为 keep-alive 连接。

一个长连接会保持一段时间，重复用于发送一系列请求，节省了新建 TCP 连接握手的时间，还可以利用 TCP 的性能增强能力。

连接在空闲时段时间后会被关闭（服务器可以使用 Keep-Alive 头来指定一个最小的连接保持时间）。

缺点：在空闲状态，还是会消耗服务器资源；而且在重负载时，还可能遭受 DoS 攻击。这种场景下，可以尽快关闭那些空闲的连接。

HTTP/1.1 默认就是长连接。

（新的请求要在之前的请求返回后才会发送出去。）

## HTTP 流水线（pipelining）

默认情况下，HTTP 请求时按熟悉怒发出的，下一个请求只有在当前请求收到应答后才会被发出。

流水线是在同一条长连接上发出连续的请求，而不用等待回答返回。

流水线有很多限制，现代浏览器默认没有启用这个特性。

解决流水线问题需要设计更先进的连接管理模型，HTTP/2 已经在尝试了。

## 域名分片（Domain sharding）

（在 HTTP/2 里，没必要做域名分片，甚至可能影响性能。）

作为 HTTP/1.x 的连接，请求是序列化的，后面的请求只能等待前面的请求返回。

一个解决方案是，浏览器为每个域名建立多个连接，以事先并发请求。曾经默认为 2~3 个连接，现在常用的是6个并发连接数。如果尝试大于这个数字，就有触发服务器 DoS 保护的风险。

如果服务器端想要更快速地响应网站的应答，它可以迫使客户端建立更多的连接。例如，不在同一个域名下获取所有资源，可以把一个域名拆成多个域名（子域名）：a.xxx.com、b.xxx.com等。所有这些域名都指向同一台服务器，浏览器会同时为每个域名建立6条连接。这一技术被称作域名分片。